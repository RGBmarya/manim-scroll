# Manim Scroll API Reference

Complete type definitions and API documentation for manim-scroll.

## Types

### RenderManifest

The manifest file structure generated by the Python CLI:

```typescript
interface RenderManifest {
  scene: string;           // Scene class name (e.g., "TextScene")
  fps: number;             // Frames per second
  width: number;           // Resolution width
  height: number;          // Resolution height
  frames: string[];        // Relative paths to PNG frames
  video: string | null;    // Relative path to video file (mp4/webm)
  transparent?: boolean;   // Whether background is transparent
  inline?: boolean;        // Whether in inline mode
  aspectRatio?: number | null;  // Aspect ratio from bounds.json
}
```

### ScrollRangeValue

Flexible scroll range configuration:

```typescript
type ScrollRangePreset = "viewport" | "element" | "full";

type ScrollRangeValue =
  | ScrollRangePreset                                    // Preset
  | [start: string | number, end: string | number]       // Tuple
  | { start?: number; end?: number };                    // Legacy object
```

**Preset definitions:**
- `"viewport"`: Animation plays as element crosses the viewport (start = viewportHeight, end = -elementHeight)
- `"element"`: Animation tied to element's own scroll position
- `"full"`: Animation spans entire document scroll

**Tuple format units:**
- `"100vh"` - viewport height percentage
- `"50%"` - element height percentage
- `"200px"` - pixels
- `300` - plain number treated as pixels

## React Component

### ManimScrollProps

```typescript
interface ManimAnimationProps {
  scene?: string;          // Scene name (default: "TextScene")
  fontSize?: number;       // Font size for text animations
  color?: string;          // Color as hex string (e.g., "#ffffff")
  font?: string;           // Font family for text
  inline?: boolean;        // Enable inline mode
  padding?: number;        // Padding in inline mode (Manim units, default: 0.2)
  [key: string]: unknown;  // Additional custom props for the scene
}

interface ManimScrollProps extends ManimAnimationProps {
  // Manifest resolution
  manifestUrl?: string;    // Explicit manifest URL (overrides auto-resolution)
  
  // Playback mode
  mode?: "auto" | "frames" | "video" | "native";
  
  // Scroll configuration
  scrollRange?: ScrollRangeValue;
  
  // Native mode options
  fontUrl?: string;        // URL to font file (woff, woff2, ttf, otf)
  strokeWidth?: number;    // Stroke width for drawing phase (default: 2)
  
  // Canvas options
  canvas?: {
    width?: number;
    height?: number;
  };
  
  // Callbacks
  onReady?: () => void;
  onProgress?: (progress: number) => void;
  
  // Styling
  className?: string;
  style?: React.CSSProperties;
  
  // Content
  children?: React.ReactNode;  // Text content (extracted as `text` prop)
}
```

## React Hooks

### useManimScroll

Hook for pre-rendered animation control.

```typescript
interface UseManimScrollOptions {
  ref: React.RefObject<HTMLElement | null>;  // Container element (required)
  manifestUrl?: string;                       // Explicit manifest URL
  scene?: string;                             // Scene name for auto-resolution
  animationProps?: Record<string, unknown>;   // Props for auto-resolution
  mode?: "auto" | "frames" | "video";         // Playback mode
  scrollRange?: ScrollRangeValue;             // Scroll range configuration
  canvasDimensions?: {
    width?: number;
    height?: number;
  };
  enabled?: boolean;                          // Whether hook is active (default: true)
}

interface UseManimScrollResult {
  progress: number;                           // Current scroll progress (0-1)
  isReady: boolean;                           // Whether animation is loaded
  error: Error | null;                        // Loading error, if any
  canvasRef: React.RefObject<HTMLCanvasElement | null>;
  seek: (progress: number) => void;           // Seek to specific progress
  pause: () => void;                          // Pause scroll-driven updates
  resume: () => void;                         // Resume scroll-driven updates
  isPaused: boolean;                          // Whether updates are paused
}

function useManimScroll(options: UseManimScrollOptions): UseManimScrollResult;
```

### useNativeAnimation

Hook for native SVG text animation.

```typescript
interface UseNativeAnimationOptions {
  ref: React.RefObject<HTMLElement | null>;  // Container element (required)
  text: string;                               // Text to animate (required)
  fontSize?: number;                          // Font size (inherits if undefined)
  color?: string;                             // Text color (default: "#ffffff")
  fontUrl?: string;                           // Font file URL for opentype.js
  strokeWidth?: number;                       // Stroke width (default: 2)
  scrollRange?: ScrollRangeValue;             // Scroll range configuration
  enabled?: boolean;                          // Whether hook is active (default: true)
}

interface UseNativeAnimationResult {
  progress: number;                           // Current scroll progress (0-1)
  isReady: boolean;                           // Whether animation is ready
  error: Error | null;                        // Initialization error, if any
  pause: () => void;                          // Pause scroll-driven updates
  resume: () => void;                         // Resume scroll-driven updates
  isPaused: boolean;                          // Whether updates are paused
}

function useNativeAnimation(options: UseNativeAnimationOptions): UseNativeAnimationResult;
```

## Runtime API

### registerScrollAnimation

Register a pre-rendered scroll animation (vanilla JS).

```typescript
interface ScrollAnimationOptions {
  container: HTMLElement;           // Container element (required)
  manifestUrl: string;              // URL to manifest.json (required)
  mode?: "auto" | "frames" | "video";
  canvas?: HTMLCanvasElement;       // Optional canvas (created if not provided)
  scrollRange?: ScrollRangeValue;
  onReady?: () => void;
  onProgress?: (progress: number) => void;
}

function registerScrollAnimation(options: ScrollAnimationOptions): Promise<() => void>;
// Returns cleanup function
```

### registerNativeAnimation

Register a native text animation (vanilla JS).

```typescript
interface NativeAnimationOptions {
  container: HTMLElement;           // Container element (required)
  text: string;                     // Text to animate (required)
  fontSize?: number;                // Font size (inherits if undefined)
  color?: string;                   // Text color (default: "#ffffff")
  fontUrl?: string;                 // Font file URL for opentype.js
  strokeWidth?: number;             // Stroke width (default: 2)
  scrollRange?: ScrollRangeValue;
  onReady?: () => void;
  onProgress?: (progress: number) => void;
}

function registerNativeAnimation(options: NativeAnimationOptions): Promise<() => void>;
// Returns cleanup function
```

### ScrollPlayer Class

Low-level class for pre-rendered animations.

```typescript
class ScrollPlayer {
  constructor(options: {
    container: HTMLElement;
    manifestUrl: string;
    mode?: "auto" | "frames" | "video";
    canvas?: HTMLCanvasElement;
    scrollRange?: ScrollRangeValue;
    onReady?: () => void;
    onProgress?: (progress: number) => void;
  });

  init(): Promise<void>;           // Initialize player
  destroy(): void;                 // Cleanup and remove listeners
  seek(progress: number): void;    // Seek to progress (0-1)
}
```

### NativeTextPlayer Class

Low-level class for native SVG animations.

```typescript
class NativeTextPlayer {
  constructor(options: {
    container: HTMLElement;
    text: string;
    fontSize?: number;
    color?: string;
    fontUrl?: string;
    strokeWidth?: number;
    scrollRange?: ScrollRangeValue;
    onReady?: () => void;
    onProgress?: (progress: number) => void;
  });

  init(): Promise<void>;           // Initialize player
  destroy(): void;                 // Cleanup and remove listeners
  seek(progress: number): void;    // Seek to progress (0-1)
}
```

## Utility Functions

### computePropsHash

Compute deterministic hash for animation props.

```typescript
function computePropsHash(scene: string, props: Record<string, unknown>): string;
// Returns 8-character hex string (e.g., "a1b2c3d4")
```

### extractChildrenText

Extract text content from React children.

```typescript
function extractChildrenText(children: React.ReactNode): string | null;
// Returns trimmed string or null
```

## Next.js Plugin

### withManimScroll

Wrap Next.js config with manim-scroll plugin.

```typescript
interface ManimScrollConfig {
  pythonPath?: string;      // Python executable (default: "python3")
  cliPath?: string;         // Path to render CLI (auto-detected)
  templatesDir?: string;    // Path to scene templates (auto-detected)
  concurrency?: number;     // Max parallel renders (default: CPU count - 1)
  fps?: number;             // Frames per second (default: 30)
  resolution?: string;      // Resolution as "WxH" (default: "1920x1080")
  quality?: string;         // Manim quality: l, m, h, k (default: "h")
  format?: string;          // Output: "frames", "video", "both" (default: "both")
  include?: string[];       // Glob patterns to include
  exclude?: string[];       // Glob patterns to exclude
  cleanOrphans?: boolean;   // Remove unused cache (default: true)
  verbose?: boolean;        // Verbose logging (default: false)
}

function withManimScroll(
  nextConfig: NextConfig,
  manimScrollConfig?: ManimScrollConfig
): NextConfig;

// Or combined format:
function withManimScroll(config: NextConfig & { manimScroll?: ManimScrollConfig }): NextConfig;
```

## Python CLI

### Command Line Options

```
python render/cli.py [OPTIONS]

Required:
  --scene-file PATH      Path to the Manim scene file
  --scene-name NAME      Scene class name to render
  --output-dir PATH      Directory for render outputs

Optional:
  --format FORMAT        Output format: frames, video, both (default: both)
  --fps NUMBER           Frames per second (default: 30)
  --resolution WxH       Resolution (default: 1920x1080)
  --quality PRESET       Manim quality: l, m, h, k (default: k)
  --video-format FORMAT  Video format: mp4, webm (default: mp4)
  --props PATH           Path to JSON props file
  --transparent          Render with transparent background
```

### Environment Variables

Used by scene templates to receive props:

```
MANIM_SCROLL_PROPS       Path to JSON file with animation props
MANIM_SCROLL_BOUNDS_OUT  Path to write bounds.json (for inline mode)
```

### TextScene Props

Props supported by the built-in TextScene template:

```typescript
interface TextSceneProps {
  text?: string;           // Text content (default: "Hello Manim")
  fontSize?: number;       // Font size (default: 64)
  font_size?: number;      // Alias for fontSize
  color?: string;          // Hex color (default: "#FFFFFF")
  font?: string;           // Font family
  inline?: boolean;        // Enable tight frame fitting
  padding?: number;        // Padding in Manim units (default: 0.1)
}
```

### Manifest Output

The CLI generates a `manifest.json` file:

```json
{
  "scene": "TextScene",
  "fps": 30,
  "width": 1920,
  "height": 1080,
  "frames": [
    "frames/0001.png",
    "frames/0002.png"
  ],
  "video": "video.mp4",
  "transparent": false,
  "inline": false,
  "aspectRatio": null
}
```

For inline mode with bounds.json:

```json
{
  "textWidth": 5.2,
  "textHeight": 1.1,
  "aspectRatio": 4.73,
  "inline": true,
  "padding": 0.1
}
```
